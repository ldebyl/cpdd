.TH CPDD 1 "2025" "cpdd" "User Commands"
.SH NAME
cpdd \- copy files with content-based deduplication
.SH SYNOPSIS
.B cpdd
[\fIOPTIONS\fR] \fISOURCE\fR... \fIDESTINATION\fR
.SH DESCRIPTION
.B cpdd
is a file copy utility that provides content-based deduplication by linking to identical files in a reference directory. It performs efficient three-stage matching: file size comparison, MD5 checksum verification, and byte-by-byte content comparison.

When a reference directory is specified, files with identical content are linked (hard or symbolic) rather than copied, saving disk space and preserving storage efficiency.
.SH OPTIONS
.TP
.BR \-r ", " \-\-reference " " \fIDIR\fR
Use \fIDIR\fR as reference directory for content-based linking. Files in \fISOURCE\fR that match content in \fIDIR\fR will be linked instead of copied. Defaults to hard links.
.TP
.BR \-L ", " \-\-hard-link
Create hard links to reference files when content matches. This is the default when a reference directory is specified.
.TP
.BR \-s ", " \-\-symbolic-link
Create symbolic links to reference files when content matches.
.TP
.BR \-R ", " \-\-recursive
Copy directories recursively.
.TP
.BR \-n ", " \-\-no-clobber
Never overwrite existing files.
.TP
.BR \-i ", " \-\-interactive
Prompt before overwriting existing files.
.TP
.BR \-p
Preserve file attributes (equivalent to \fB\-\-preserve=mode,ownership,timestamps\fR).
.TP
.BR \-\-preserve [=\fIATTR_LIST\fR]
Preserve specified file attributes. If no \fIATTR_LIST\fR is given, preserves mode, ownership, and timestamps. Available attributes:
.RS
.IP \(bu 4
.B mode
\- file permissions
.IP \(bu 4
.B ownership
\- user and group ownership
.IP \(bu 4
.B timestamps
\- access and modification times
.IP \(bu 4
.B all
\- all of the above
.RE
.TP
.BR \-\-stats
Display statistics after the copy operation, including number of files copied, linked, and skipped.
.TP
.BR \-h ", " \-\-human-readable
Show file sizes in human-readable format (K, M, G) in statistics and verbose output.
.TP
.BR \-v ", " \-\-verbose
Verbose output showing files being processed and their disposition.
.TP
.BR \-\-help
Display help message and exit.
.SH EXAMPLES
.TP
.B Basic file copy:
cpdd file1.txt file2.txt /dest/
.TP
.B Recursive directory copy:
cpdd \-R src1/ src2/ /dest/
.TP
.B Copy with hard link deduplication:
cpdd \-r /reference/ \-R \-v source/ /dest/
.TP
.B Copy with symbolic link deduplication:
cpdd \-r /reference/ \-s \-\-stats source/ /dest/
.TP
.B Interactive copy preserving attributes:
cpdd \-i \-p \-R src/ dest/
.SH FILE MATCHING ALGORITHM
.B cpdd
uses a three-stage matching process for efficient deduplication:
.IP 1. 4
.B Size comparison
\- Files must have identical size to be considered for matching.
.IP 2. 4
.B MD5 checksum
\- Only calculated for files with non-unique sizes in the reference directory, providing an efficient pre-filter.
.IP 3. 4
.B Byte-by-byte comparison
\- Final verification ensures content is truly identical before linking.

This approach minimizes expensive I/O operations while guaranteeing correctness.
.SH EXIT STATUS
.B cpdd
exits with status 0 on success, 1 on error.
.SH FILES
No configuration files are used.
.SH NOTES
Hard links can only be created between files on the same filesystem. If hard linking fails, 
.B cpdd
will fall back to copying the file normally.

Symbolic links contain the path to the target file and can span filesystems, but may break if the reference directory is moved or deleted.
.SH BUGS
Report bugs at: https://github.com/32kb-net/cpdd/issues
.SH AUTHOR
Written by Lee de Byl <lee@32kb.net>.
.SH COPYRIGHT
Copyright \(co 2025 Lee de Byl. Licensed under the MIT License.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
.SH SEE ALSO
.BR cp (1),
.BR rsync (1),
.BR ln (1),
.BR find (1),
.BR md5sum (1)